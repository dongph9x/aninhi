# üõ°Ô∏è H·ªá Th·ªëng Spam Protection

## üìã T·ªïng Quan

H·ªá th·ªëng spam protection ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ ngƒÉn ch·∫∑n vi·ªác spam c√°c l·ªánh quan tr·ªçng nh∆∞ c√¢u c√°, battle, feed. H·ªá th·ªëng theo d√µi v√† gi·ªõi h·∫°n s·ªë l·∫ßn s·ª≠ d·ª•ng l·ªánh c·ªßa user trong m·ªôt kho·∫£ng th·ªùi gian nh·∫•t ƒë·ªãnh.

**üÜï T√≠nh nƒÉng m·ªõi:** Tool Spam Detection - Ph√°t hi·ªán spam t·ª± ƒë·ªông d·ª±a tr√™n pattern th·ªùi gian!

## üéØ T√≠nh NƒÉng Ch√≠nh

### ‚úÖ Ch·ªëng Spam Th√¥ng Minh
- **Cooldown:** Th·ªùi gian ch·ªù gi·ªØa c√°c l·∫ßn s·ª≠ d·ª•ng l·ªánh
- **Rate Limiting:** Gi·ªõi h·∫°n s·ªë l·∫ßn s·ª≠ d·ª•ng trong timeWindow
- **Warning System:** C·∫£nh c√°o tr∆∞·ªõc khi ban
- **Auto Ban:** T·ª± ƒë·ªông t·∫°m kh√≥a user spam qu√° nhi·ªÅu

### ü§ñ Tool Spam Detection (M·ªõi)
- **Pattern Detection:** Ph√°t hi·ªán pattern th·ªùi gian gi·ªëng nhau
- **Time Tolerance:** ƒê·ªô sai s·ªë cho ph√©p (¬±2 gi√¢y)
- **Auto Ban Tool Spam:** Ban 1 ph√∫t cho tool spam
- **Advanced Analytics:** Ph√¢n t√≠ch chi ti·∫øt pattern spam

### ‚úÖ L·ªánh ƒê∆∞·ª£c B·∫£o V·ªá
- **Fishing:** 30s cooldown, 5 l·∫ßn/5 ph√∫t
- **Battle:** 60s cooldown, 3 l·∫ßn/10 ph√∫t  
- **Feed:** 15s cooldown, 10 l·∫ßn/5 ph√∫t

### ‚úÖ H·ªá Th·ªëng C·∫£nh C√°o
- **Level 1:** C·∫£nh c√°o nh·∫π
- **Level 2:** C·∫£nh c√°o nghi√™m tr·ªçng
- **Level 3:** T·∫°m kh√≥a 30 ph√∫t
- **Tool Spam Level:** C·∫£nh c√°o tool spam ‚Üí Ban 1 ph√∫t
- **Extended Spam Level:** C·∫£nh c√°o extended spam ‚Üí Ban 5 ph√∫t

## üèóÔ∏è Ki·∫øn Tr√∫c H·ªá Th·ªëng

### üìÅ C·∫•u Tr√∫c Files
```
src/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ spam-protection.ts      # C·∫•u h√¨nh spam protection + tool spam
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ spam-protection.ts      # Spam protection service + tool spam detection
‚îú‚îÄ‚îÄ commands/text/moderation/
‚îÇ   ‚îú‚îÄ‚îÄ spamstats.ts            # Xem th·ªëng k√™ spam
‚îÇ   ‚îú‚îÄ‚îÄ resetspam.ts            # Reset spam records
‚îÇ   ‚îú‚îÄ‚îÄ unbanuser.ts            # M·ªü kh√≥a user
‚îÇ   ‚îî‚îÄ‚îÄ toolspam.ts             # Xem th·ªëng k√™ tool spam (M·ªõi)
‚îî‚îÄ‚îÄ commands/text/ecommerce/
    ‚îî‚îÄ‚îÄ fishing.ts              # T√≠ch h·ª£p spam protection
```

### üîß C·∫•u H√¨nh Spam Protection
```typescript
interface SpamProtectionConfig {
  enabled: boolean;              // B·∫≠t/t·∫Øt h·ªá th·ªëng
  cooldown: number;              // Th·ªùi gian ch·ªù (gi√¢y)
  maxAttempts: number;           // S·ªë l·∫ßn t·ªëi ƒëa
  timeWindow: number;            // Kho·∫£ng th·ªùi gian (gi√¢y)
  warningThreshold: number;      // Ng∆∞·ª°ng c·∫£nh c√°o
  banThreshold: number;          // Ng∆∞·ª°ng ban
  toolSpamDetection: {           // Tool spam detection (M·ªõi)
    enabled: boolean;
    minAttempts: number;         // S·ªë l·∫ßn t·ªëi thi·ªÉu ƒë·ªÉ ph√°t hi·ªán
    timeTolerance: number;       // ƒê·ªô sai s·ªë cho ph√©p (gi√¢y)
    patternThreshold: number;    // S·ªë l·∫ßn pattern gi·ªëng nhau
    banDuration: number;         // Th·ªùi gian ban (ph√∫t)
  };
}
```

## üéÆ C√°ch S·ª≠ D·ª•ng

### L·ªánh Qu·∫£n L√Ω
```bash
# Xem th·ªëng k√™ spam
n.spamstats @user
n.spamstats @user fishing

# Xem th·ªëng k√™ tool spam (M·ªõi)
n.toolspam @user
n.toolspam @user fishing

# Reset spam records
n.resetspam @user
n.resetspam @user fishing

# M·ªü kh√≥a user
n.unbanuser @user
n.unbanuser @user fishing
```

### Aliases
```bash
# Spam stats
spamstats, spam, th·ªëng k√™ spam, spamstatistics

# Tool spam stats (M·ªõi)
toolspam, toolspamstats, spamdetection, ph√°t hi·ªán spam

# Reset spam
resetspam, resetspamrecord, x√≥a spam, cleanspam

# Unban user
unbanuser, unban, m·ªü kh√≥a, unlockuser
```

## ‚öôÔ∏è C·∫•u H√¨nh Chi Ti·∫øt

### Fishing Command
```typescript
fishing: {
  name: 'fishing',
  aliases: ['fish', 'c√¢u', 'c√°'],
  cooldown: 30,        // 30 gi√¢y gi·ªØa c√°c l·∫ßn
  maxAttempts: 5,      // T·ªëi ƒëa 5 l·∫ßn
  timeWindow: 300,     // Trong 5 ph√∫t
}
```

### Battle Command
```typescript
battle: {
  name: 'battle',
  aliases: ['ƒë√°nh', 'chi·∫øn'],
  cooldown: 60,        // 60 gi√¢y gi·ªØa c√°c l·∫ßn
  maxAttempts: 3,      // T·ªëi ƒëa 3 l·∫ßn
  timeWindow: 600,     // Trong 10 ph√∫t
}
```

### Feed Command
```typescript
feed: {
  name: 'feed',
  aliases: ['cho ƒÉn', 'ƒÉn'],
  cooldown: 15,        // 15 gi√¢y gi·ªØa c√°c l·∫ßn
  maxAttempts: 10,     // T·ªëi ƒëa 10 l·∫ßn
  timeWindow: 300,     // Trong 5 ph√∫t
}
```

### Tool Spam Detection Config
```typescript
toolSpamDetection: {
  enabled: true,
  minAttempts: 3,      // C·∫ßn √≠t nh·∫•t 3 l·∫ßn ƒë·ªÉ ph√°t hi·ªán
  timeTolerance: 2,    // ƒê·ªô sai s·ªë ¬±2 gi√¢y
  patternThreshold: 2, // 2 l·∫ßn pattern gi·ªëng nhau = tool spam
  banDuration: 1,      // Ban 1 ph√∫t cho tool spam
}
```

### Extended Spam Monitoring Config
```typescript
extendedSpamMonitoring: {
  enabled: true,
  timeWindow: 300,      // 5 ph√∫t = 300 gi√¢y
  maxAttempts: 20,      // T·ªëi ƒëa 20 l·∫ßn trong 5 ph√∫t
  warningThreshold: 15, // C·∫£nh c√°o sau 15 l·∫ßn vi ph·∫°m
  banThreshold: 20,     // Ban sau 20 l·∫ßn vi ph·∫°m
  banDuration: 1,       // Ban 1 ph√∫t cho extended spam
  frequencyDetection: {
    enabled: true,
    minAttempts: 3,     // C·∫ßn √≠t nh·∫•t 3 l·∫ßn ƒë·ªÉ ph√°t hi·ªán
    timeTolerance: 2,   // ƒê·ªô sai s·ªë ¬±2 gi√¢y
    patternThreshold: 2, // 2 l·∫ßn pattern gi·ªëng nhau = frequency spam
  },
}
```

## ü§ñ Tool Spam Detection

### üéØ C√°ch Ho·∫°t ƒê·ªông

#### 1. **Thu Th·∫≠p D·ªØ Li·ªáu**
```typescript
// Theo d√µi th·ªùi gian gi·ªØa c√°c l·∫ßn th·ª≠
const timeSinceLastAttempt = (now - record.timestamp) / 1000;
record.timeIntervals.push(timeSinceLastAttempt);
```

#### 2. **Ph√°t Hi·ªán Pattern**
```typescript
// T√¨m pattern ph·ªï bi·∫øn nh·∫•t
const patterns = findTimePatterns(intervals, timeTolerance);
// V√≠ d·ª•: 20s, 20s, 21s, 20s ‚Üí Pattern: 20s (3 l·∫ßn)
```

#### 3. **ƒê√°nh Gi√° Tool Spam**
```typescript
// N·∫øu pattern xu·∫•t hi·ªán >= patternThreshold l·∫ßn
if (pattern.count >= patternThreshold) {
  return { detected: true, pattern: pattern.interval };
}
```

### üìä V√≠ D·ª• Tool Spam

#### ‚úÖ **Spam T·ª± Nhi√™n:**
```
12:00:00 - L·∫ßn 1
12:00:35 - L·∫ßn 2 (35s)
12:01:12 - L·∫ßn 3 (37s)
12:01:48 - L·∫ßn 4 (36s)
12:02:25 - L·∫ßn 5 (37s)
```
**K·∫øt qu·∫£:** Kh√¥ng ph√°t hi·ªán tool spam (th·ªùi gian kh√¥ng ƒë·ªÅu)

#### ‚ùå **Tool Spam:**
```
12:00:00 - L·∫ßn 1
12:00:20 - L·∫ßn 2 (20s)
12:00:40 - L·∫ßn 3 (20s)
12:01:00 - L·∫ßn 4 (20s)
12:01:20 - L·∫ßn 5 (20s)
```
**K·∫øt qu·∫£:** Ph√°t hi·ªán tool spam (pattern 20s xu·∫•t hi·ªán 4 l·∫ßn) ‚Üí Ban 1 ph√∫t

## üìä Extended Spam Monitoring

### üéØ C√°ch Ho·∫°t ƒê·ªông

#### 1. **Thu Th·∫≠p D·ªØ Li·ªáu**
```typescript
// Theo d√µi t·∫•t c·∫£ l·∫ßn th·ª≠ trong 5 ph√∫t
record.extendedAttemptsHistory.push(now);

// T√≠nh th·ªùi gian gi·ªØa c√°c l·∫ßn th·ª≠ trong extended window
if (record.extendedAttemptsHistory.length > 1) {
  const timeSinceLastExtendedAttempt = (now - lastAttempt) / 1000;
  record.extendedTimeIntervals.push(timeSinceLastExtendedAttempt);
}
```

#### 2. **Ph√¢n T√≠ch TimeWindow**
```typescript
// L·ªçc c√°c l·∫ßn th·ª≠ trong 5 ph√∫t g·∫ßn nh·∫•t
const extendedWindowStart = now - (timeWindow * 1000);
const recentAttempts = record.extendedAttemptsHistory.filter(timestamp => timestamp >= extendedWindowStart);
```

#### 3. **ƒê√°nh Gi√° Extended Spam**
```typescript
// N·∫øu s·ªë l·∫ßn th·ª≠ > maxAttempts ho·∫∑c >= warningThreshold
if (record.extendedAttempts > maxAttempts || record.extendedAttempts >= warningThreshold) {
  return { detected: true };
}
```

#### 4. **Ph√°t Hi·ªán Frequency Spam**
```typescript
// T√¨m pattern ph·ªï bi·∫øn nh·∫•t trong 5 ph√∫t
const patterns = this.findTimePatterns(record.extendedTimeIntervals, timeTolerance);

// Ki·ªÉm tra xem c√≥ pattern n√†o xu·∫•t hi·ªán ƒë·ªß s·ªë l·∫ßn kh√¥ng
for (const pattern of patterns) {
  if (pattern.count >= patternThreshold) {
    return { detected: true, pattern: pattern.interval };
  }
}
```

### üìä V√≠ D·ª• Extended Spam + Frequency Detection

#### ‚úÖ **Spam B√¨nh Th∆∞·ªùng:**
```
12:00:00 - L·∫ßn 1
12:00:30 - L·∫ßn 2 (30s)
12:01:00 - L·∫ßn 3 (30s)
...
12:04:30 - L·∫ßn 19 (30s)
12:05:00 - L·∫ßn 20 (30s)
```
**K·∫øt qu·∫£:** Kh√¥ng ph√°t hi·ªán extended spam (20 l·∫ßn trong 5 ph√∫t = ƒë√∫ng gi·ªõi h·∫°n)

#### ‚ùå **Extended Spam (V∆∞·ª£t Qu√° S·ªë L·∫ßn):**
```
12:00:00 - L·∫ßn 1
12:00:15 - L·∫ßn 2
12:00:30 - L·∫ßn 3
...
12:04:45 - L·∫ßn 21 ‚Üê V∆∞·ª£t qu√° 20 l·∫ßn
```
**K·∫øt qu·∫£:** Ph√°t hi·ªán extended spam (21 l·∫ßn > 20 l·∫ßn trong 5 ph√∫t) ‚Üí Ban 5 ph√∫t

#### ‚ùå **Frequency Spam (Pattern T·ª± ƒê·ªông):**
```
12:00:00 - L·∫ßn 1
12:00:20 - L·∫ßn 2 (20s)
12:00:40 - L·∫ßn 3 (20s)
12:01:00 - L·∫ßn 4 (20s)
12:01:20 - L·∫ßn 5 (20s)
...
12:04:40 - L·∫ßn 15 (20s)
```
**K·∫øt qu·∫£:** Ph√°t hi·ªán frequency spam (pattern 20s xu·∫•t hi·ªán nhi·ªÅu l·∫ßn ¬±2s) ‚Üí Ban 5 ph√∫t

### üîç **Thu·∫≠t To√°n K·∫øt H·ª£p**

#### 1. **Theo D√µi Timeline + Frequency**
```typescript
// L∆∞u timestamp c·ªßa m·ªói l·∫ßn th·ª≠
record.extendedAttemptsHistory.push(now);

// T√≠nh th·ªùi gian gi·ªØa c√°c l·∫ßn th·ª≠
if (record.extendedAttemptsHistory.length > 1) {
  const timeSinceLastExtendedAttempt = (now - lastAttempt) / 1000;
  record.extendedTimeIntervals.push(timeSinceLastExtendedAttempt);
}
```

#### 2. **L·ªçc TimeWindow**
```typescript
// Ch·ªâ t√≠nh c√°c l·∫ßn th·ª≠ trong 5 ph√∫t g·∫ßn nh·∫•t
const recentAttempts = record.extendedAttemptsHistory.filter(timestamp => timestamp >= fiveMinutesAgo);
```

#### 3. **So S√°nh Threshold + Pattern**
```typescript
// Ki·ªÉm tra s·ªë l·∫ßn th·ª≠
if (record.extendedAttempts >= warningThreshold) {
  // C·∫£nh c√°o extended spam
}

// Ki·ªÉm tra frequency pattern
const patterns = this.findTimePatterns(record.extendedTimeIntervals, timeTolerance);
for (const pattern of patterns) {
  if (pattern.count >= patternThreshold) {
    // C·∫£nh c√°o frequency spam
  }
}
```

## üõ°Ô∏è Spam Protection Service

### SpamProtectionService Class
```typescript
class SpamProtectionService {
  // Singleton pattern
  static getInstance(): SpamProtectionService

  // Ki·ªÉm tra spam (bao g·ªìm tool spam)
  checkSpam(userId: string, guildId: string, command: string): {
    allowed: boolean;
    reason?: string;
    cooldown?: number;
    embed?: EmbedBuilder;
    toolSpamDetected?: boolean;
    pattern?: string;
  }

  // Ph√°t hi·ªán tool spam
  private detectToolSpam(record: SpamRecord): {
    detected: boolean;
    pattern?: number;
  }

  // T√¨m patterns th·ªùi gian
  private findTimePatterns(intervals: number[], tolerance: number): Array<{
    interval: number;
    count: number;
  }>

  // Reset spam record
  resetSpamRecord(userId: string, guildId: string, command: string): boolean

  // Unban user (bao g·ªìm tool spam ban)
  unbanUser(userId: string, guildId: string, command: string): boolean

  // L·∫•y th·ªëng k√™ spam
  getSpamStats(userId: string, guildId: string, command: string): SpamRecord | null

  // Cleanup records c≈©
  cleanupOldRecords(): number
}
```

### SpamRecord Interface (C·∫≠p Nh·∫≠t)
```typescript
interface SpamRecord {
  userId: string;
  guildId: string;
  command: string;
  timestamp: number;
  attempts: number;
  warnings: number;
  isBanned: boolean;
  banExpiresAt?: number;
  // Tool spam detection (M·ªõi)
  timeIntervals: number[];           // Th·ªùi gian gi·ªØa c√°c l·∫ßn th·ª≠
  toolSpamWarnings: number;          // S·ªë l·∫ßn c·∫£nh c√°o tool spam
  isToolSpamBanned: boolean;         // B·ªã ban do tool spam
  toolSpamBanExpiresAt?: number;     // Th·ªùi gian h·∫øt h·∫°n ban tool spam
  // Extended spam monitoring (M·ªõi)
  extendedAttempts: number;           // S·ªë l·∫ßn th·ª≠ trong extended timeWindow
  extendedWarnings: number;          // S·ªë l·∫ßn c·∫£nh c√°o extended spam
  isExtendedSpamBanned: boolean;     // B·ªã ban do extended spam
  extendedSpamBanExpiresAt?: number; // Th·ªùi gian h·∫øt h·∫°n ban extended spam
  extendedAttemptsHistory: number[];  // L·ªãch s·ª≠ c√°c l·∫ßn th·ª≠ trong extended window
  extendedTimeIntervals: number[];   // Th·ªùi gian gi·ªØa c√°c l·∫ßn th·ª≠ trong extended window
  // Frequency detection trong extended spam
  frequencySpamWarnings: number;      // S·ªë l·∫ßn c·∫£nh c√°o frequency spam
  isFrequencySpamBanned: boolean;    // B·ªã ban do frequency spam
  frequencySpamBanExpiresAt?: number; // Th·ªùi gian h·∫øt h·∫°n ban frequency spam
}
```

## üéØ Logic Ho·∫°t ƒê·ªông

### 1. Ki·ªÉm Tra Extended Spam Ban
```typescript
// Ki·ªÉm tra extended spam ban tr∆∞·ªõc
if (record.isExtendedSpamBanned && record.extendedSpamBanExpiresAt && now < record.extendedSpamBanExpiresAt) {
  return { allowed: false, reason: "extended_spam_banned" };
}
```

### 2. Ki·ªÉm Tra Frequency Spam Ban
```typescript
// Ki·ªÉm tra frequency spam ban
if (record.isFrequencySpamBanned && record.frequencySpamBanExpiresAt && now < record.frequencySpamBanExpiresAt) {
  return { allowed: false, reason: "frequency_spam_banned" };
}
```

### 3. Thu Th·∫≠p D·ªØ Li·ªáu Extended Spam + Frequency
```typescript
// C·∫≠p nh·∫≠t extended attempts history
record.extendedAttemptsHistory.push(now);

// T√≠nh th·ªùi gian gi·ªØa c√°c l·∫ßn th·ª≠ trong extended window
if (record.extendedAttemptsHistory.length > 1) {
  const timeSinceLastExtendedAttempt = (now - lastAttempt) / 1000;
  record.extendedTimeIntervals.push(timeSinceLastExtendedAttempt);
}

// Ki·ªÉm tra extended spam monitoring
const extendedSpamResult = this.checkExtendedSpam(record, now);
if (extendedSpamResult.detected) {
  // C·∫£nh c√°o/Ban extended spam
}

// Ki·ªÉm tra frequency spam trong extended window
const frequencySpamResult = this.detectFrequencySpam(record);
if (frequencySpamResult.detected) {
  // C·∫£nh c√°o/Ban frequency spam
}
```

### 4. Ph√°t Hi·ªán Tool Spam
```typescript
// Ki·ªÉm tra tool spam pattern
const toolSpamResult = this.detectToolSpam(record);
if (toolSpamResult.detected) {
  record.toolSpamWarnings++;
  
  if (record.toolSpamWarnings >= patternThreshold) {
    // Ban tool spam
    record.isToolSpamBanned = true;
    record.toolSpamBanExpiresAt = now + (banDuration * 60 * 1000);
  }
}
```

### 5. Ki·ªÉm Tra Spam Th∆∞·ªùng
```typescript
// Ki·ªÉm tra cooldown v√† rate limiting nh∆∞ b√¨nh th∆∞·ªùng
if (timeSinceLastAttempt < commandConfig.cooldown) {
  return { allowed: false, reason: "cooldown" };
}
```

## üé® UI/UX Features

### Embed Colors
- **Success:** Green (#51cf66)
- **Error:** Red (#ff0000)
- **Warning:** Orange (#ffa500)
- **Info:** Blue (#51cf66)
- **Tool Spam:** Purple (#9932cc)

### Emojis
- **üõ°Ô∏è** - Spam Protection
- **ü§ñ** - Tool Spam Detection
- **‚è∞** - Cooldown
- **‚ö†Ô∏è** - Warning
- **üî®** - Ban
- **‚úÖ** - Success
- **‚ùå** - Error
- **üìä** - Statistics
- **üîç** - Pattern Detection

### Messages
```typescript
const spamMessages = {
  cooldown: "‚è∞ **Cooldown!** B·∫°n c·∫ßn ch·ªù {time} gi√¢y n·ªØa m·ªõi c√≥ th·ªÉ {command}.",
  warning: "‚ö†Ô∏è **C·∫£nh c√°o spam!** B·∫°n ƒë√£ {attempts} l·∫ßn {command} qu√° nhanh.",
  ban: "üî® **B·ªã t·∫°m kh√≥a!** B·∫°n ƒë√£ spam {command} qu√° nhi·ªÅu l·∫ßn.",
  unbanned: "‚úÖ **ƒê√£ m·ªü kh√≥a!** B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng {command} b√¨nh th∆∞·ªùng.",
  stats: "üìä **Th·ªëng k√™ spam:** {attempts} l·∫ßn trong {timeWindow} gi√¢y",
  // Tool spam messages (M·ªõi)
  toolSpamWarning: "ü§ñ **C·∫£nh c√°o Tool Spam!** Ph√°t hi·ªán pattern spam t·ª± ƒë·ªông.",
  toolSpamBan: "üî® **B·ªã t·∫°m kh√≥a Tool Spam!** Ph√°t hi·ªán s·ª≠ d·ª•ng tool spam t·ª± ƒë·ªông.",
  toolSpamDetected: "ü§ñ **Tool Spam Detected!** Pattern: {pattern} gi√¢y ¬± {tolerance} gi√¢y",
};
```

## üîê Permissions

### L·ªánh Spam Stats
- **Permission:** `ModerateMembers`
- **M√¥ t·∫£:** Xem th·ªëng k√™ spam c·ªßa user

### L·ªánh Tool Spam Stats (M·ªõi)
- **Permission:** `ModerateMembers`
- **M√¥ t·∫£:** Xem th·ªëng k√™ tool spam chi ti·∫øt

### L·ªánh Reset Spam
- **Permission:** `Administrator`
- **M√¥ t·∫£:** Reset spam records c·ªßa user

### L·ªánh Unban User
- **Permission:** `Administrator`
- **M√¥ t·∫£:** M·ªü kh√≥a user b·ªã ban spam (bao g·ªìm tool spam)

## üö® Error Handling

### Validation
```typescript
// Ki·ªÉm tra user h·ª£p l·ªá
if (!targetUser) {
  throw new Error("Ng∆∞·ªùi d√πng kh√¥ng h·ª£p l·ªá");
}

// Ki·ªÉm tra command h·ª£p l·ªá
if (!commandConfig) {
  return { allowed: true }; // Kh√¥ng b·∫£o v·ªá command n√†y
}

// Ki·ªÉm tra tool spam detection enabled
if (!spamProtectionConfig.toolSpamDetection.enabled) {
  return { detected: false };
}
```

### Try-Catch
```typescript
try {
  const spamCheck = spamService.checkSpam(userId, guildId, command);
  // X·ª≠ l√Ω k·∫øt qu·∫£
} catch (error) {
  console.error("Spam protection error:", error);
  // Fallback: cho ph√©p th·ª±c hi·ªán l·ªánh
  return { allowed: true };
}
```

## üîÑ Roadmap

### Phase 1: Core Features ‚úÖ
- [x] H·ªá th·ªëng spam protection c∆° b·∫£n
- [x] Cooldown v√† rate limiting
- [x] Warning system
- [x] Auto ban system
- [x] Admin management commands

### Phase 2: Tool Spam Detection ‚úÖ
- [x] Pattern detection algorithm
- [x] Time interval tracking
- [x] Tool spam warning system
- [x] Tool spam ban system
- [x] Advanced analytics

### Phase 3: Advanced Features üöß
- [ ] Database storage cho spam records
- [ ] Persistent ban system
- [ ] Custom cooldown per user
- [ ] Whitelist system
- [ ] Machine learning detection

### Phase 4: Integration Features üöß
- [ ] Integration v·ªõi warning system
- [ ] Logging system
- [ ] Webhook notifications
- [ ] Dashboard analytics
- [ ] API endpoints

## üêõ Troubleshooting

### L·ªói Th∆∞·ªùng G·∫∑p

#### 1. "User b·ªã kh√≥a tool spam qu√° l√¢u"
```bash
# Gi·∫£i ph√°p
n.unbanuser @user
n.resetspam @user
```

#### 2. "Tool spam detection kh√¥ng ho·∫°t ƒë·ªông"
```bash
# Ki·ªÉm tra config
- toolSpamDetection.enabled: true
- minAttempts >= 3
- timeTolerance > 0
- patternThreshold > 0
```

#### 3. "Pattern detection qu√° nh·∫°y/kh√¥ng nh·∫°y"
```bash
# ƒêi·ªÅu ch·ªânh config
timeTolerance: 2,        // TƒÉng/gi·∫£m ƒë·ªô sai s·ªë
patternThreshold: 2,     // TƒÉng/gi·∫£m s·ªë l·∫ßn pattern
minAttempts: 3,         // TƒÉng/gi·∫£m s·ªë l·∫ßn t·ªëi thi·ªÉu
```

#### 4. "Kh√¥ng th·ªÉ reset tool spam records"
```bash
# Ki·ªÉm tra permissions
- C·∫ßn quy·ªÅn Administrator
- User ph·∫£i t·ªìn t·∫°i
- Command ph·∫£i h·ª£p l·ªá
```

## üìù Changelog

### v1.3.0 (Current) - Extended Spam + Frequency Detection
- ‚úÖ Extended spam monitoring system v·ªõi frequency detection
- ‚úÖ 5-minute timeWindow tracking v·ªõi pattern analysis
- ‚úÖ 20 attempts limit trong 5 ph√∫t
- ‚úÖ Frequency spam detection v·ªõi ¬±2s tolerance
- ‚úÖ Extended spam warning system
- ‚úÖ Frequency spam warning system
- ‚úÖ Extended spam ban system (5 ph√∫t)
- ‚úÖ Frequency spam ban system (5 ph√∫t)
- ‚úÖ Advanced timeline analytics
- ‚úÖ Enhanced toolspam command v·ªõi frequency stats
- ‚úÖ Comprehensive spam protection v·ªõi 4 l·ªõp b·∫£o v·ªá

### v1.2.0 (Previous) - Extended Spam Monitoring
- ‚úÖ Extended spam monitoring system
- ‚úÖ 5-minute timeWindow tracking
- ‚úÖ 20 attempts limit in 5 minutes
- ‚úÖ Extended spam warning system
- ‚úÖ Extended spam ban system (5 ph√∫t)
- ‚úÖ Advanced timeline analytics
- ‚úÖ Enhanced toolspam command
- ‚úÖ Comprehensive spam protection

### v1.1.0 (Previous) - Tool Spam Detection
- ‚úÖ Tool spam detection algorithm
- ‚úÖ Pattern recognition system
- ‚úÖ Time interval tracking
- ‚úÖ Tool spam warning system
- ‚úÖ Tool spam ban system (1 ph√∫t)
- ‚úÖ Advanced analytics v√† reporting
- ‚úÖ Tool spam stats command
- ‚úÖ Enhanced UI/UX v·ªõi tool spam indicators

### v1.0.0 (Previous)
- ‚úÖ H·ªá th·ªëng spam protection c∆° b·∫£n
- ‚úÖ Cooldown v√† rate limiting
- ‚úÖ Warning v√† auto ban system
- ‚úÖ Admin management commands
- ‚úÖ Integration v·ªõi fishing command
- ‚úÖ UI/UX v·ªõi embeds v√† emojis

### v1.2.0 (Planned)
- üöß Database storage
- üöß Persistent ban system
- üöß Custom cooldown per user
- üöß Whitelist system
- üöß Machine learning detection

### v1.3.0 (Planned)
- üöß Integration v·ªõi warning system
- üöß Advanced analytics
- üöß Webhook notifications
- üöß Dashboard
- üöß API endpoints